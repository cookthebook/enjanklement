<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="css/spectre/spectre.min.css">
  <link rel="stylesheet" href="css/spectre/spectre-exp.min.css">
  <link rel="stylesheet" href="css/spectre/spectre-icons.min.css">
</head>

<body class="container">
  <h1>The BulkJank Deck Builder</h1>
  <p>
    Below is the entire list of all BulkJank legal cards along with their deck point value.
    Begin construction of your deck and the stats will automatically update.
  </p>

  <div class="columns">
    <div class="col-mx-auto">
      <label>Deck List</label>
      <div id="deck-list">
      </div>
      <label>Card Search</label>
      <div id="bulk-search">
      </div>
    </div>
  </div>
</body>

<script src="js/fuzzysort.js"></script>
<script src="js/jank.js"></script>
<script src="js/bulk.js"></script>
<script>
  var deck = {};
  var deck_elem = document.getElementById('deck-list');

  function rerender_deck() {
    while (deck_elem.childNodes.length > 0) {
      deck_elem.firstChild.remove();
    }

    Object.keys(deck).forEach(cardname => {
      var elem = document.createElement('p')
      elem.innerText = `${cardname} : ${deck[cardname].count} x ${deck[cardname].data.points}`;
      deck_elem.appendChild(elem);
    });
  }

  function add_card_to_deck(cardname, card) {
    if (deck[cardname] !== undefined) {
      deck[cardname].count += 1;
      rerender_deck();
      return;
    }

    deck[cardname] = {
      data: card,
      count: 1,
      elem: null
    };
    rerender_deck();
  }

  function gen_card_action(cardname, card) {
    var ret = document.createElement('button');
    ret.classList.add('btn', 'btn-primary');
    ret.innerText = '+';
    ret.addEventListener('click', () => {
      add_card_to_deck(cardname, card);
    });
    return ret;
  }

  var bulk_elem = document.getElementById('bulk-search');
  var bulk_search = new BulkSearch(bulk_elem, gen_card_action);
  bulk_search.render();
</script>

</html>